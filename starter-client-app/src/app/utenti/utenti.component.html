<div class="listComponentContainer" fxLayout="row" fxLayoutAlign="start start" fxLayoutGap="20px">
    <div fxFlex>
        <div class="overlay" *ngIf="isLoadingResults">
            <div class="center">
                <mat-progress-spinner style="margin:0 auto;" class="loading-shade" color="accent" mode="indeterminate">
                </mat-progress-spinner>
            </div>
        </div>
        <div style="max-height: 80vh;overflow: auto;" class="table-container">

            <table mat-table [dataSource]="tableDataSource" matSort matSortActive="Nominativo" matSortDirection="asc"
                class="mat-elevation-z8 pratiko-table" multiTemplateDataRows>
                <ng-container matColumnDef="ID">
                    <th mat-header-cell *matHeaderCellDef> ID </th>
                    <td mat-cell *matCellDef="let element"> {{element.ID}} </td>
                </ng-container>
                <ng-container matColumnDef="Nome">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header> Nome </th>
                    <td mat-cell *matCellDef="let element"> {{ element.Nome }} </td>
                </ng-container>
                <ng-container matColumnDef="Cognome">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header> Cognome </th>
                    <td mat-cell *matCellDef="let element"> {{ element.Cognome }} </td>
                </ng-container>
                <ng-container matColumnDef="Email">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header> Email </th>
                    <td mat-cell *matCellDef="let element"> {{ element.Username }} </td>
                </ng-container>

                <ng-container matColumnDef="disclaimer">
                    <td mat-footer-cell *matFooterCellDef [attr.colspan]="displayedColumns.length">
                        <span *ngIf="listError">Errore caricamento dati</span>
                    </td>
                </ng-container>
                <ng-container matColumnDef="plus-btn">
                    <th mat-header-cell *matHeaderCellDef colspan="1" class="grid-plus-btn">
                        <button mat-raised-button color="accent" (click)="addNewClicked()" class="block-h"
                            *ngIf="isAuthorizedToModify()">
                            <mat-icon matTooltip="Create a new role">add</mat-icon><span fxShow="true"
                                fxHide.lt-sm="true">
                                NUOVO UTENTE
                            </span>
                        </button>
                    </th>
                </ng-container>
                <!-- Expanded Content Column - The detail row is made up of this one column that spans across all columns -->
                <ng-container matColumnDef="expandedDetail">
                    <td mat-cell *matCellDef="let element" [attr.colspan]="displayedColumns.length">
                        <div class="grid-element-detail"
                            [@detailExpand]="element == selectedElement ? 'expanded' : 'collapsed'" fxLayout="row">
                            <!--<app-preview-with-actions [detail]="utenteDetail" [element]="element" [routePath]="'/utenti/' + (element.ID ? element.ID : 'new') + '?email=' +element.Username" style="width: 100%;"></app-preview-with-actions>-->
                            <!--<ng-template #detailTemplate>
                        <app-utente-detail [showOnlyPreview]="true" [element]="element"></app-utente-detail>
                    </ng-template>-->
                            <app-preview-detail [detailTemplate]="detailTemplate"
                                [routePath]="'/utenti/' + (element.ID ? element.ID : 'new/'+element.Username)"
                                style="width: 100%;"></app-preview-detail>
                            <ng-template #detailTemplate>
                                <app-utente-detail [showOnlyPreview]="true" [element]="element"></app-utente-detail>
                            </ng-template>
                        </div>
                    </td>
                </ng-container>

                <ng-container matColumnDef="search">
                    <th mat-header-cell *matHeaderCellDef [attr.colspan]="displayedColumns.length - 1">
                        <mat-form-field class="block-h grid-filter-field">
                            <mat-label>Cerca...</mat-label>
                            <input matInput (keyup)="applyFilter($event)" autocomplete="off">
                            <mat-icon matSuffix [inline]="true" style="color: white;">search</mat-icon>
                        </mat-form-field>
                    </th>
                </ng-container>

                <tr mat-header-row *matHeaderRowDef="['search', 'plus-btn']" class="commands-header-row"></tr>

                <tr mat-header-row *matHeaderRowDef="displayedColumns" class="titles-header-row"></tr>

                <tr mat-row *matRowDef="let row; columns: displayedColumns;" class="grid-element-row"
                    [class.grid-expanded-row]="selectedElement === row" (click)="onRowClicked(row)"
                    (dblclick)="onRowDoubleClicked(row)"></tr>
                <tr mat-row *matRowDef="let row; columns: ['expandedDetail']" class="grid-detail-row"></tr>
                <ng-container>
                    <tr mat-footer-row *matFooterRowDef="['disclaimer']" class="footer-row"></tr>
                </ng-container>
            </table>
        </div>
        <mat-paginator [length]="resultsLength" [pageSize]="10" [pageSizeOptions]="[5, 10, 25, 100]" color="primary">
        </mat-paginator>
    </div>
    <div fxFlex [@routeAnimations]="prepareRoute(o)">
        <router-outlet #o="outlet"></router-outlet>
    </div>
</div>